## TODO!!

zkontrolovat sazbu
shorten links
fallback img na basepairs.datmos.org
limit na refset datasource
favicon?
molstar?



### publikace:

* Energetics of hydrogen bonds in peptides https://www.pnas.org/doi/10.1073/pnas.2133366100
    - asi tam odsud ukrást hodnotu ~1.5 kcal/mol?

* RNABuilder
    - https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4428339/

* Stephen Neidle - Principles of Nucleic Acid Structure-Academic Press


### osnova

co je NA, co je par, saenger a LW nazvoslovi
pary byly poskytnuty od freda, autor je Craig
ensembl byl poskytnut jirkou

publikace se muze prekryvat, to je jedno
 - chteji pridat CIF kategorii, rigorozni definici
 - chteji konzervativni definici

je ok psát o implementaci?
 - B: určitě rozepsat
 - pymol skript
 - preskakuju non-std residua
web?
 - B: samozrejme

Results and discussion se Bohdanovi víc líbí dohromady

### blbost

Interesting pair: 6W6L 1 D 40  D 104  both parallel and antiparallel

Saenger čísla prý používá PDB a rafinační programy

### Citace

NAKB, DNATCO aspoň


WebTODO

* proc se nespocital cWH C-C !!!
* NULLy v jednom z fieldů?
    * často protože DNA a jeden z těch edgů je v DNA jednoprvkový    
* cWW AA symetrické páry

fetch 3vjr
select pair, 3vjr and (chain B and resi 33 or chain D and resi 33)
show sticks, %pair
orient %pair
hide everything, not %pair


```sql
CREATE OR REPLACE TEMP MACRO sanitize_alt(a) AS nullif(nullif(nullif(trim(a), chr(0)), '?'), '');
CREATE OR REPLACE TEMP MACRO format_altdot(a) AS coalesce('.' || sanitize_alt(a), '');


copy(
    select * replace (
        lower(pdbid) as pdbid,
        sanitize_alt(alt1) AS alt1,
        sanitize_alt(ins1) as ins1,
        sanitize_alt(alt2) as alt2,
        sanitize_alt(ins2) as ins2
    )
    from '/mnt/Aldabrachelys/test/vsecky-pary-raw.parquet'
)
to '/mnt/Aldabrachelys/test/vsecky-pary.parquet' (format parquet);

copy(
select * from '/mnt/Aldabrachelys/test/vsecky-pary.parquet'
    where lower(pdbid || '_' || chain1 || '_' || res1 || format_altdot(alt1) || '_' || nr1::text || format_altdot(ins1)) in (select lower(column0) from '~/tmp/basepaircsv/hbonds/*.csv')
    or lower(pdbid || '_' || chain2 || '_' || res2 || format_altdot(alt2) || '_' || nr2::text || format_altdot(ins2)) in (select lower(column0) from '~/tmp/basepaircsv/hbonds/*.csv'))
to '/mnt/Aldabrachelys/test/vsecky-pary-refset.parquet' (format parquet);

copy(
    select pdbid, model, chain1, res1, nr1, ins1, alt1, chain2, res2, nr2, ins2, alt2,
        --    tripletx, triplety, tripletz, pdbsymstr, gemmisymstr, gemmi_shortest
        NULL::text as symmetry_operation1, nullif(pdbsymstr, '1_555') as symmetry_operation2
    from '/mnt/Aldabrachelys/test/vsecky-pary.parquet'
)
to '/mnt/Aldabrachelys/test/vsecky-paryID.parquet' (format parquet);

copy(
    select pdbid, model, chain2 as chain1, res2 as res1, nr2 as nr1, ins2 as ins1, alt2 as alt1, chain1 as chain2, res1 as res2, nr1 as nr2, ins1 as ins2, alt1 as alt2,
        --    tripletx, triplety, tripletz, pdbsymstr, gemmisymstr, gemmi_shortest
        nullif(pdbsymstr, '1_555') as symmetry_operation1, NULL::text as symmetry_operation2
    from '/mnt/Aldabrachelys/test/vsecky-pary.parquet'
)
to '/mnt/Aldabrachelys/test/vsecky-paryIDinv.parquet' (format parquet);

--python3 ./pairs.py /mnt/Aldabrachelys/test/pdb/fr3d_6e88eb7d_bpdet/*_basepair_detail.txt --pdbcache /mnt/Aldabrachelys/test/pdb/s --threads 32 --export-only --output /mnt/Aldabrachelys/test/pdb/analyzed-bonds/fr3d-exportonly.csv


copy(
    select lower(pdbid) as pdbid, model, chain1, res1, nr1, ins1, alt1, chain2, res2, nr2, ins2, alt2, symmetry_operation1, symmetry_operation2
    from '/mnt/Aldabrachelys/test/pdb/analyzed-bonds/fr3d-exportonly.csv.parquet'
    where lower(pdbid || '_' || chain1 || '_' || res1 || format_altdot(alt1) || '_' || nr1::text || format_altdot(ins1)) in (select lower(column0) from '~/tmp/basepaircsv/hbonds/*.csv')
       or lower(pdbid || '_' || chain2 || '_' || res2 || format_altdot(alt2) || '_' || nr2::text || format_altdot(ins2)) in (select lower(column0) from '~/tmp/basepaircsv/hbonds/*.csv')
)
to '/mnt/Aldabrachelys/test/pdb/analyzed-bonds/fr3d-exportonly-refset-ID.parquet';




copy (select * from '/home/exyi/code/rna-ml/pairclusters/out/plots-reexport0413/*-filtered.parquet') to '/mnt/Aldabrachelys/test/pymol-vids/work/all-approved-detailed.parquet' (format parquet);
```




```
find . -type f -name '*.parquet' -printf "%CF %CH:%CM\t%s\t%P\n" | sort -k 4 | awk -F\t 'BEGIN { print "<html><title>List of tables directory</title><body><h1>List of tables/</h1><table><tr><th> Last changed</th><th>Size (MiB)</th><th>Size (rows)</th><th>File</th></tr>" } { "duckdb -list -noheader -s \'select count(*) as rows from read_parquet(\"" $3 "\")\'" | getline count; printf "<tr><td>%s</td>\t<td>%.2g MiB</td>\t<td>%d rows</td>\t<td><a href=\"./%s\" download>%s</a></td></tr>\n", $1, $2/1024/1024, count, $3, $3} END { print "</table></body></html>" }' > index.html
```


```sql
COPY (SELECT DISTINCT ON (pairid, family)
                 * EXCLUDE (comparison_in_baseline, comparison_in_current),
                 bool_or(comparison_in_baseline) OVER (PARTITION BY pairid) as comparison_in_baseline,
                 bool_or(comparison_in_current) OVER (PARTITION BY pairid) as comparison_in_current             FROM (                 SELECT *, TRUE AS comparison_in_current, FALSE AS comparison_in_baseline
FROM nabirnew                 UNION ALL BY NAME                 SELECT *, FALSE AS comparison_in_current, TRUE AS comparison_in_baseline FROM fr3d                 ORDER BY comparison_in_current DESC             )) to 'union-with-fr3d.parquet';
```

TODO:


zkusit přidat (ehh)
  --and abs(columns('hb_\d_OOPA.*')) < abs(coplanarity_angle - 180)
  --and abs(columns('shift\d'))-1.0 < abs(sin(radians(coplanarity_angle)))
  --and (@hb_0_OOPA1 + @hb_0_OOPA2 + @hb_1_OOPA1 + @hb_1_OOPA2 + @hb_2_OOPA1 + @hb_2_OOPA2)/6 < abs(coplanarity_angle-180)/3

  --and abs(columns('hb_\d_OOPA.*')) < abs(coplanarity_angle - 180)
  --and abs(columns('shift\d'))-2.0 < abs(sin(coplanarity_angle))
